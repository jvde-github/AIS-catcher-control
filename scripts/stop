#!/bin/bash

# Configuration
PIDFILE="/etc/AIS-catcher/aiscatcher.pid"

# Function to stop the program
stop() {
    if [ ! -f "$PIDFILE" ]; then
        echo "PID file not found. Is the program running?"
        exit 1
    fi

    PID=$(cat "$PIDFILE")
    if ! kill -0 "$PID" 2>/dev/null; then
        echo "No process found with PID $PID. Removing PID file."
        rm -f "$PIDFILE"
        exit 1
    fi

    echo "Stopping program with PID $PID..."
    kill "$PID"

    # Wait for the process to terminate
    TIMEOUT=30
    while kill -0 "$PID" 2>/dev/null; do
        if [ $TIMEOUT -le 0 ]; then
            echo "Failed to stop program gracefully. Killing it."
            kill -9 "$PID"
            break
        fi
        sleep 1
        TIMEOUT=$((TIMEOUT - 1))
    done

    rm -f "$PIDFILE"
    echo "Program stopped."
}

stop "$@"
