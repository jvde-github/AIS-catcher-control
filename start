#!/bin/bash

# Configuration
PROGRAM="/usr/bin/AIS-catcher"
ARGS="-C /etc/AIS-catcher/config.json -t txt 192.168.1.113 5012 -v"

PIDFILE="/etc/AIS-catcher/aiscatcher.pid"
LOGFILE="/etc/AIS-catcher/log.txt"

start() {
    if [ -f "$PIDFILE" ] && kill -0 $(cat "$PIDFILE") 2>/dev/null; then
        echo "Program is already running with PID $(cat "$PIDFILE")."
        exit 1
    fi

    echo "Starting program..."
    # Start the program with nohup and redirect both stdout and stderr to the log file
    nohup "$PROGRAM" $ARGS >> "$LOGFILE" 2>&1 &
    # Save the PID of the background process
    echo $! > "$PIDFILE"
    echo "Program started with PID $(cat "$PIDFILE")."
}

start "$@"
